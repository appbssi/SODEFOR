/**
 * @file Firestore Security Rules
 * @description This ruleset enforces a strict data-access model. All users can read all data. Only authenticated users can create, update, and delete.
 *
 * Data Structure:
 * - /personnel/{personnelId}: Stores personnel information.
 * - /attendance/{attendanceId}: Stores attendance records.
 * - /dailyStatus/{day}: Stores daily validation status.
 * - /missions/{missionId}: Stores mission details.
 *
 * Key Security Decisions:
 * - Public read access for all collections.
 * - Authenticated user required for write access (create, update, delete) to any collection.
 *
 * Denormalization for Authorization:
 * - Not applicable in this ruleset. Authentication is the sole requirement for write access.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows anyone to read personnel data. Only signed-in users can create, update, or delete.
     * @path /personnel/{personnelId}
     * @allow (get, list): if true
     * @allow (create, update, delete): if isSignedIn()
     * @deny (create, update, delete): if !isSignedIn()
     * @principle Allows public reads and restricts writes to authenticated users.
     */
    match /personnel/{personnelId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows anyone to read attendance data. Only signed-in users can create, update, or delete.
     * @path /attendance/{attendanceId}
     * @allow (get, list): if true
     * @allow (create, update, delete): if isSignedIn()
     * @deny (create, update, delete): if !isSignedIn()
     * @principle Allows public reads and restricts writes to authenticated users.
     */
    match /attendance/{attendanceId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows anyone to read daily status data. Only signed-in users can create, update, or delete.
     * @path /dailyStatus/{day}
     * @allow (get, list): if true
     * @allow (create, update, delete): if isSignedIn()
     * @deny (create, update, delete): if !isSignedIn()
     * @principle Allows public reads and restricts writes to authenticated users.
     */
    match /dailyStatus/{day} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows anyone to read mission data. Only signed-in users can create, update, or delete.
     * @path /missions/{missionId}
     * @allow (get, list): if true
     * @allow (create, update, delete): if isSignedIn()
     * @deny (create, update, delete): if !isSignedIn()
     * @principle Allows public reads and restricts writes to authenticated users.
     */
    match /missions/{missionId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Helper function to check if a user is signed in.
     * @return {boolean} True if the user is signed in, false otherwise.
     */
    function isSignedIn() {
      return request.auth != null;
    }
  }
}